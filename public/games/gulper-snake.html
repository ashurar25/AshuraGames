
<!DOCTYPE html>
<html   lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏á‡∏π‡∏î‡∏π‡∏î‡∏û‡∏•‡∏±‡∏á - ASHURA Games</title>
    <!-- ASHURA:shared-css -->
    <link rel="stylesheet" href="./game-enhancement.css">
    <link rel="stylesheet" href="./game-optimization.css">
    <link rel="stylesheet" href="./_assets/game-frame.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            overflow: hidden;
            color: white;
        }

        canvas {
            display: block;
            background: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
            cursor: crosshair;
        }

        #gameUI {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 100;
        }

        #scoreHUD {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.5);
            backdrop-filter: blur(10px);
            font-weight: bold;
        }

        #leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.5);
            backdrop-filter: blur(10px);
            min-width: 200px;
        }

        #leaderboard h3 {
            color: #10b981;
            margin-bottom: 10px;
            text-align: center;
            font-size: 16px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        #startMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 25px;
            border: 2px solid rgba(16, 185, 129, 0.5);
            backdrop-filter: blur(20px);
            text-align: center;
            pointer-events: auto;
            min-width: 400px;
        }

        #startMenu h1 {
            color: #10b981;
            margin-bottom: 30px;
            font-size: 36px;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.7);
        }

        .menu-section {
            margin: 25px 0;
        }

        .menu-section h3 {
            color: #6ee7b7;
            margin-bottom: 15px;
            font-size: 18px;
        }

        #playerName {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 15px;
            font-size: 16px;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        #playerName::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        #skinSelector {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .skin-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .skin-option.selected {
            border-color: #10b981;
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.7);
        }

        .skin-option:hover {
            transform: scale(1.1);
        }

        #startButton {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.3);
        }

        #startButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
            background: linear-gradient(135deg, #059669, #047857);
        }

        #gameOverMenu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 25px;
            border: 2px solid rgba(239, 68, 68, 0.5);
            backdrop-filter: blur(20px);
            text-align: center;
            pointer-events: auto;
            display: none;
        }

        #gameOverMenu h2 {
            color: #ef4444;
            margin-bottom: 20px;
            font-size: 28px;
        }

        #finalStats {
            margin: 20px 0;
            font-size: 16px;
        }

        #restartButton {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        #restartButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        #credits {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 12px;
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            animation: particleFade 1s ease-out forwards;
        }

        @keyframes particleFade {
            0% { opacity: 1; transform: scale(1) rotate(0deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }

        @media (max-width: 768px) {
            #startMenu {
                min-width: 300px;
                padding: 30px 20px;
            }
            
            #startMenu h1 {
                font-size: 28px;
            }
            
            #leaderboard {
                min-width: 150px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="gameUI">
        <div id="scoreHUD">
            <div style="color: #10b981; font-size: 18px; margin-bottom: 5px;">üêç Gulper Snake</div>
            <div>Length: <span id="playerLength">1</span></div>
            <div>Score: <span id="playerScore">0</span></div>
            <div style="font-size: 12px; margin-top: 5px; color: rgba(255,255,255,0.7);">
                Player: <span id="currentPlayer">Guest</span>
            </div>
        </div>

        <div id="leaderboard">
            <h3>üèÜ Top Players</h3>
            <div id="leaderboardList"></div>
        </div>

        <div id="startMenu">
            <h1>‡∏á‡∏π‡∏î‡∏π‡∏î‡∏û‡∏•‡∏±‡∏á</h1>
            
            <div class="menu-section">
                <h3>Enter Your Name</h3>
                <input type="text" id="playerName" placeholder="Enter your name..." maxlength="15">
            </div>

            <div class="menu-section">
                <h3>Choose Your Skin</h3>
                <div id="skinSelector">
                    <div class="skin-option selected" data-skin="0" style="background: linear-gradient(45deg, #10b981, #059669);"></div>
                    <div class="skin-option" data-skin="1" style="background: linear-gradient(45deg, #3b82f6, #1d4ed8);"></div>
                    <div class="skin-option" data-skin="2" style="background: linear-gradient(45deg, #f59e0b, #d97706);"></div>
                    <div class="skin-option" data-skin="3" style="background: linear-gradient(45deg, #ef4444, #dc2626);"></div>
                    <div class="skin-option" data-skin="4" style="background: linear-gradient(45deg, #8b5cf6, #7c3aed);"></div>
                    <div class="skin-option" data-skin="5" style="background: linear-gradient(45deg, #ec4899, #be185d);"></div>
                </div>
            </div>

            <div class="menu-section">
                <button id="startButton">üöÄ Start Game</button>
            </div>
        </div>

        <div id="gameOverMenu">
            <h2>üíÄ Game Over!</h2>
            <div id="finalStats">
                <div>Final Length: <span id="finalLength">0</span></div>
                <div>Final Score: <span id="finalScore">0</span></div>
                <div id="newRecordText" style="color: #fbbf24; margin-top: 10px; display: none;">
                    üéâ New Personal Record!
                </div>
            </div>
            <button id="restartButton">üîÑ Play Again</button>
        </div>

        <div id="instructions">
            üñ±Ô∏è Mouse: Steer | ‚å®Ô∏è Arrow Keys: Move | üöÄ Space/Click: Boost
        </div>

        <div id="credits">
            ¬© ASHURA Games
        </div>
    </div>

    <script>
        class GulperSnake {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                
                // Game state
                this.gameState = 'menu'; // menu, playing, gameOver
                this.player = null;
                this.aiSnakes = [];
                this.food = [];
                this.particles = [];
                
                // Input
                this.keys = {};
                this.mouse = { x: 0, y: 0 };
                this.mouseDown = false;
                
                // Game settings
                this.worldSize = { width: 4000, height: 3000 };
                this.camera = { x: 0, y: 0 };
                this.selectedSkin = 0;
                this.playerName = 'Guest';
                
                // Snake skins
                this.skins = [
                    { primary: '#10b981', secondary: '#059669', name: 'Emerald' },
                    { primary: '#3b82f6', secondary: '#1d4ed8', name: 'Blue' },
                    { primary: '#f59e0b', secondary: '#d97706', name: 'Orange' },
                    { primary: '#ef4444', secondary: '#dc2626', name: 'Red' },
                    { primary: '#8b5cf6', secondary: '#7c3aed', name: 'Purple' },
                    { primary: '#ec4899', secondary: '#be185d', name: 'Pink' }
                ];

                // Leaderboard
                this.leaderboard = this.loadLeaderboard();
                
                this.setupEventListeners();
                this.updateLeaderboard();
                this.gameLoop();
            }

            resizeCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            setupEventListeners() {
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Keyboard
                window.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;
                    if (e.code === 'Space') {
                        e.preventDefault();
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });
                
                // Mouse
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.clientX - rect.left;
                    this.mouse.y = e.clientY - rect.top;
                });
                
                this.canvas.addEventListener('mousedown', () => {
                    this.mouseDown = true;
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.mouseDown = false;
                });

                // Touch for mobile
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.mouseDown = true;
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.touches[0].clientX - rect.left;
                    this.mouse.y = e.touches[0].clientY - rect.top;
                });

                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.touches[0].clientX - rect.left;
                    this.mouse.y = e.touches[0].clientY - rect.top;
                });

                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.mouseDown = false;
                });
                
                // UI Elements
                document.getElementById('startButton').addEventListener('click', () => this.startGame());
                document.getElementById('restartButton').addEventListener('click', () => this.restartGame());
                
                // Skin selector
                document.querySelectorAll('.skin-option').forEach((option, index) => {
                    option.addEventListener('click', () => this.selectSkin(index));
                });
                
                // Player name input
                document.getElementById('playerName').addEventListener('input', (e) => {
                    this.playerName = e.target.value || 'Guest';
                });
            }

            selectSkin(index) {
                document.querySelectorAll('.skin-option').forEach(option => 
                    option.classList.remove('selected'));
                document.querySelector(`[data-skin="${index}"]`).classList.add('selected');
                this.selectedSkin = index;
            }

            startGame() {
                this.gameState = 'playing';
                document.getElementById('startMenu').style.display = 'none';
                
                // Create player snake
                this.player = this.createSnake(
                    this.worldSize.width / 2, 
                    this.worldSize.height / 2, 
                    this.skins[this.selectedSkin],
                    true
                );
                this.player.name = this.playerName;
                
                // Create AI snakes
                this.aiSnakes = [];
                for (let i = 0; i < 8; i++) {
                    const x = Math.random() * this.worldSize.width;
                    const y = Math.random() * this.worldSize.height;
                    const skin = this.skins[Math.floor(Math.random() * this.skins.length)];
                    const aiSnake = this.createSnake(x, y, skin, false);
                    aiSnake.name = this.generateAIName();
                    aiSnake.aiTimer = 0;
                    this.aiSnakes.push(aiSnake);
                }
                
                // Generate food
                this.generateFood();
                
                document.getElementById('currentPlayer').textContent = this.playerName;
            }

            createSnake(x, y, skin, isPlayer = false) {
                return {
                    x, y,
                    angle: Math.random() * Math.PI * 2,
                    speed: isPlayer ? 3 : 2.5,
                    maxSpeed: isPlayer ? 5 : 4,
                    segments: [{ x, y }],
                    length: 10,
                    targetLength: 10,
                    radius: 8,
                    skin,
                    isPlayer,
                    name: '',
                    score: 0,
                    boosting: false
                };
            }

            generateAIName() {
                const names = [
                    'SlitherBot', 'CobraAI', 'ViperBot', 'PythonAI', 'AnacondaBot',
                    'RattlerAI', 'MambaBot', 'BoaAI', 'AdderBot', 'AspAI'
                ];
                return names[Math.floor(Math.random() * names.length)] + Math.floor(Math.random() * 100);
            }

            generateFood() {
                this.food = [];
                for (let i = 0; i < 500; i++) {
                    this.food.push({
                        x: Math.random() * this.worldSize.width,
                        y: Math.random() * this.worldSize.height,
                        color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                        radius: 3 + Math.random() * 4,
                        value: 1
                    });
                }
            }

            updatePlayer() {
                if (!this.player) return;
                
                // Handle input
                let targetAngle = this.player.angle;
                
                // Mouse control
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const dx = this.mouse.x - centerX;
                const dy = this.mouse.y - centerY;
                
                if (Math.abs(dx) > 50 || Math.abs(dy) > 50) {
                    targetAngle = Math.atan2(dy, dx);
                }
                
                // Keyboard control
                if (this.keys['ArrowLeft'] || this.keys['KeyA']) {
                    targetAngle -= 0.1;
                }
                if (this.keys['ArrowRight'] || this.keys['KeyD']) {
                    targetAngle += 0.1;
                }
                if (this.keys['ArrowUp'] || this.keys['KeyW']) {
                    targetAngle -= 0.05;
                }
                if (this.keys['ArrowDown'] || this.keys['KeyS']) {
                    targetAngle += 0.05;
                }
                
                // Smooth turning
                let angleDiff = targetAngle - this.player.angle;
                if (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                if (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
                
                this.player.angle += angleDiff * 0.1;
                
                // Boosting
                this.player.boosting = this.keys['Space'] || this.mouseDown;
                
                if (this.player.boosting && this.player.targetLength > 15) {
                    this.player.speed = this.player.maxSpeed;
                    this.player.targetLength -= 0.02; // Shrink while boosting
                    
                    // Boost particles
                    if (Math.random() < 0.3) {
                        this.createParticles(
                            this.player.x - Math.cos(this.player.angle) * 20,
                            this.player.y - Math.sin(this.player.angle) * 20,
                            1, '#10b981'
                        );
                    }
                } else {
                    this.player.speed = this.player.maxSpeed * 0.7;
                }
                
                this.updateSnake(this.player);
            }

            updateAI() {
                this.aiSnakes.forEach(snake => {
                    snake.aiTimer += 1;
                    
                    // Find nearest food
                    let nearestFood = null;
                    let nearestDist = Infinity;
                    
                    this.food.forEach(food => {
                        const dist = Math.hypot(snake.x - food.x, snake.y - food.y);
                        if (dist < nearestDist) {
                            nearestDist = dist;
                            nearestFood = food;
                        }
                    });
                    
                    // Move towards nearest food with some randomness
                    if (nearestFood && Math.random() < 0.7) {
                        const targetAngle = Math.atan2(nearestFood.y - snake.y, nearestFood.x - snake.x);
                        let angleDiff = targetAngle - snake.angle;
                        if (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                        if (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
                        snake.angle += angleDiff * 0.05;
                    } else {
                        // Random movement
                        if (snake.aiTimer > 60) {
                            snake.angle += (Math.random() - 0.5) * 0.2;
                            snake.aiTimer = 0;
                        }
                    }
                    
                    // Random boost
                    snake.boosting = Math.random() < 0.1 && snake.targetLength > 15;
                    if (snake.boosting) {
                        snake.speed = snake.maxSpeed;
                        snake.targetLength -= 0.01;
                    } else {
                        snake.speed = snake.maxSpeed * 0.7;
                    }
                    
                    this.updateSnake(snake);
                });
            }

            updateSnake(snake) {
                // Move
                snake.x += Math.cos(snake.angle) * snake.speed;
                snake.y += Math.sin(snake.angle) * snake.speed;
                
                // Wrap around world
                if (snake.x < 0) snake.x = this.worldSize.width;
                if (snake.x > this.worldSize.width) snake.x = 0;
                if (snake.y < 0) snake.y = this.worldSize.height;
                if (snake.y > this.worldSize.height) snake.y = 0;
                
                // Update segments
                snake.segments.unshift({ x: snake.x, y: snake.y });
                
                // Smooth length changes
                snake.length += (snake.targetLength - snake.length) * 0.1;
                
                const segmentSpacing = 6;
                const targetSegments = Math.floor(snake.length / segmentSpacing);
                
                if (snake.segments.length > targetSegments) {
                    snake.segments.splice(targetSegments);
                }
                
                // Check food collision
                this.food = this.food.filter(food => {
                    const dist = Math.hypot(snake.x - food.x, snake.y - food.y);
                    if (dist < snake.radius + food.radius) {
                        snake.targetLength += food.value * 3;
                        snake.score += food.value * 10;
                        this.createParticles(food.x, food.y, 5, food.color);
                        return false;
                    }
                    return true;
                });
                
                // Replenish food
                while (this.food.length < 500) {
                    this.food.push({
                        x: Math.random() * this.worldSize.width,
                        y: Math.random() * this.worldSize.height,
                        color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                        radius: 3 + Math.random() * 4,
                        value: 1
                    });
                }
            }

            updateCamera() {
                if (!this.player) return;
                
                const targetX = this.player.x - this.canvas.width / 2;
                const targetY = this.player.y - this.canvas.height / 2;
                
                this.camera.x += (targetX - this.camera.x) * 0.1;
                this.camera.y += (targetY - this.camera.y) * 0.1;
            }

            createParticles(x, y, count, color) {
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: x + (Math.random() - 0.5) * 20,
                        y: y + (Math.random() - 0.5) * 20,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 60,
                        maxLife: 60,
                        color,
                        radius: Math.random() * 4 + 2
                    });
                }
            }

            updateParticles() {
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vx *= 0.98;
                    particle.vy *= 0.98;
                    particle.life--;
                    return particle.life > 0;
                });
            }

            render() {
                this.ctx.fillStyle = '#0f172a';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.gameState !== 'playing') return;
                
                this.ctx.save();
                this.ctx.translate(-this.camera.x, -this.camera.y);
                
                // Draw grid
                this.drawGrid();
                
                // Draw food
                this.food.forEach(food => {
                    this.ctx.beginPath();
                    this.ctx.arc(food.x, food.y, food.radius, 0, Math.PI * 2);
                    this.ctx.fillStyle = food.color;
                    this.ctx.fill();
                    this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                    this.ctx.lineWidth = 1;
                    this.ctx.stroke();
                });
                
                // Draw snakes
                this.aiSnakes.forEach(snake => this.drawSnake(snake));
                if (this.player) this.drawSnake(this.player);
                
                // Draw particles
                this.particles.forEach(particle => {
                    const alpha = particle.life / particle.maxLife;
                    this.ctx.save();
                    this.ctx.globalAlpha = alpha;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.radius * alpha, 0, Math.PI * 2);
                    this.ctx.fillStyle = particle.color;
                    this.ctx.fill();
                    this.ctx.restore();
                });
                
                this.ctx.restore();
                
                // Update UI
                if (this.player) {
                    document.getElementById('playerLength').textContent = Math.floor(this.player.targetLength);
                    document.getElementById('playerScore').textContent = this.player.score;
                }
            }

            drawGrid() {
                const gridSize = 50;
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                this.ctx.lineWidth = 1;
                
                const startX = Math.floor(this.camera.x / gridSize) * gridSize;
                const startY = Math.floor(this.camera.y / gridSize) * gridSize;
                const endX = startX + this.canvas.width + gridSize;
                const endY = startY + this.canvas.height + gridSize;
                
                this.ctx.beginPath();
                for (let x = startX; x <= endX; x += gridSize) {
                    this.ctx.moveTo(x, startY);
                    this.ctx.lineTo(x, endY);
                }
                for (let y = startY; y <= endY; y += gridSize) {
                    this.ctx.moveTo(startX, y);
                    this.ctx.lineTo(endX, y);
                }
                this.ctx.stroke();
            }

            drawSnake(snake) {
                // Draw segments
                for (let i = snake.segments.length - 1; i >= 0; i--) {
                    const segment = snake.segments[i];
                    const ratio = i / snake.segments.length;
                    const segmentRadius = snake.radius * (0.3 + ratio * 0.7);
                    
                    // Body gradient
                    const gradient = this.ctx.createRadialGradient(
                        segment.x, segment.y, 0,
                        segment.x, segment.y, segmentRadius
                    );
                    gradient.addColorStop(0, snake.skin.primary);
                    gradient.addColorStop(1, snake.skin.secondary);
                    
                    this.ctx.beginPath();
                    this.ctx.arc(segment.x, segment.y, segmentRadius, 0, Math.PI * 2);
                    this.ctx.fillStyle = gradient;
                    this.ctx.fill();
                    
                    if (i === 0) {
                        // Head details
                        this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                        this.ctx.lineWidth = 2;
                        this.ctx.stroke();
                        
                        // Eyes
                        const eyeDistance = segmentRadius * 0.6;
                        const eyeSize = segmentRadius * 0.2;
                        
                        const leftEyeX = segment.x + Math.cos(snake.angle + 0.5) * eyeDistance;
                        const leftEyeY = segment.y + Math.sin(snake.angle + 0.5) * eyeDistance;
                        const rightEyeX = segment.x + Math.cos(snake.angle - 0.5) * eyeDistance;
                        const rightEyeY = segment.y + Math.sin(snake.angle - 0.5) * eyeDistance;
                        
                        this.ctx.fillStyle = 'white';
                        this.ctx.beginPath();
                        this.ctx.arc(leftEyeX, leftEyeY, eyeSize, 0, Math.PI * 2);
                        this.ctx.arc(rightEyeX, rightEyeY, eyeSize, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        this.ctx.fillStyle = 'black';
                        this.ctx.beginPath();
                        this.ctx.arc(leftEyeX, leftEyeY, eyeSize * 0.6, 0, Math.PI * 2);
                        this.ctx.arc(rightEyeX, rightEyeY, eyeSize * 0.6, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                }
                
                // Name label
                if (!snake.isPlayer) {
                    this.ctx.save();
                    this.ctx.font = '12px Arial';
                    this.ctx.fillStyle = 'white';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(snake.name, snake.x, snake.y - snake.radius - 20);
                    this.ctx.fillText(`${Math.floor(snake.targetLength)}`, snake.x, snake.y - snake.radius - 8);
                    this.ctx.restore();
                }
            }

            checkGameOver() {
                if (!this.player) return;
                
                // Check if snake is too small (can't die from collision in gulper.io style)
                if (this.player.targetLength < 5) {
                    this.gameOver();
                }
            }

            gameOver() {
                this.gameState = 'gameOver';
                
                // Update leaderboard
                const finalScore = {
                    name: this.playerName,
                    length: Math.floor(this.player.targetLength),
                    score: this.player.score,
                    date: new Date().toLocaleDateString()
                };
                
                this.leaderboard.push(finalScore);
                this.leaderboard.sort((a, b) => b.score - a.score);
                this.leaderboard = this.leaderboard.slice(0, 10);
                this.saveLeaderboard();
                this.updateLeaderboard();
                
                // Show game over screen
                document.getElementById('finalLength').textContent = finalScore.length;
                document.getElementById('finalScore').textContent = finalScore.score;
                
                // Check for new record
                const personalBest = Math.max(...this.leaderboard
                    .filter(entry => entry.name === this.playerName)
                    .map(entry => entry.score));
                
                if (finalScore.score >= personalBest) {
                    document.getElementById('newRecordText').style.display = 'block';
                }
                
                document.getElementById('gameOverMenu').style.display = 'block';
            }

            restartGame() {
                this.gameState = 'menu';
                document.getElementById('gameOverMenu').style.display = 'none';
                document.getElementById('startMenu').style.display = 'block';
                document.getElementById('newRecordText').style.display = 'none';
                
                this.player = null;
                this.aiSnakes = [];
                this.food = [];
                this.particles = [];
            }

            loadLeaderboard() {
                const saved = localStorage.getItem('gulperSnakeLeaderboard');
                return saved ? JSON.parse(saved) : [];
            }

            saveLeaderboard() {
                localStorage.setItem('gulperSnakeLeaderboard', JSON.stringify(this.leaderboard));
            }

            updateLeaderboard() {
                const list = document.getElementById('leaderboardList');
                list.innerHTML = '';
                
                const topFive = this.leaderboard.slice(0, 5);
                topFive.forEach((entry, index) => {
                    const div = document.createElement('div');
                    div.className = 'leaderboard-entry';
                    div.innerHTML = `
                        <span>${index + 1}. ${entry.name}</span>
                        <span>${entry.score}</span>
                    `;
                    list.appendChild(div);
                });
                
                if (topFive.length === 0) {
                    list.innerHTML = '<div style="text-align: center; opacity: 0.6;">No scores yet</div>';
                }
            }

            gameLoop() {
                if (this.gameState === 'playing') {
                    this.updatePlayer();
                    this.updateAI();
                    this.updateParticles();
                    this.updateCamera();
                    this.checkGameOver();
                }
                
                this.render();
                requestAnimationFrame(() => this.gameLoop());
            }
        }

        // Start the game when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° optimization CSS ‡πÅ‡∏•‡∏∞ JS
            const optimizationCSS = document.createElement('link');
            optimizationCSS.rel = 'stylesheet';
            optimizationCSS.href = 'game-optimization.css';
            document.head.appendChild(optimizationCSS);
            
            const optimizationJS = document.createElement('script');
            optimizationJS.src = 'game-optimization.js';
            optimizationJS.onload = () => {
                new GulperSnake();
            };
            document.head.appendChild(optimizationJS);
        });
    </script>
    <!-- ASHURA:shared-js -->
    <script src="./game-optimization.js"></script>
    <!-- ASHURA:gf-config -->
<script>
  window.GF_CONFIG = {
    showPauseOverlay: true,
    autoMuteOnPause: true,
    quality: 'medium',
    pixelArt: true,
    maxDevicePixelRatio: 1.25,
    resizeDebounceMs: 120,
    debug: false
  };
</script>
<script src="./_assets/game-frame.js"></script>
</body>
</html>
